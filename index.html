<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Artale ç‚é­”åŠ©æ‰‹</title>
    <link rel="stylesheet" href="https://unpkg.com/tippy.js@6/dist/tippy.css" />
    <style>
        body { 
            font-family: -apple-system, sans-serif; 
            background: #000; color: #fff; margin: 0; 
            padding: 15px 10px; 
            display: flex; flex-direction: column; align-items: center; 
            box-sizing: border-box; 
        }
        
        .setting-box { 
            background: #222; width: 100%; max-width: 400px; padding: 10px; border-radius: 12px; margin-bottom: 15px; border: 1px solid #444; text-align: center; box-sizing: border-box;
        }

        .card { 
            background: #1a1a1a; width: 100%; max-width: 400px; padding: 20px; border-radius: 20px; text-align: center; margin-bottom: 15px; border: 1px solid #333; position: relative; box-sizing: border-box;
        }
        
        .card-loop { border-left: 8px solid #00ffcc; }
        .card-time { border-left: 8px solid #feca57; }

        .title { font-size: 1.2rem; font-weight: bold; margin-bottom: 5px; }
        .timer-display { font-size: 4.5rem; font-family: 'Courier New', monospace; font-weight: bold; margin: 5px 0; }
        
        .btn { padding: 12px; font-size: 1.1rem; cursor: pointer; border: none; border-radius: 12px; width: 100%; height: 80px; font-weight: bold; -webkit-appearance: none; margin-bottom: 15px; display: flex; align-items: center; justify-content: center; }
        .start-btn { background: #444; color: #fff; }
        .delay-btn { background: #2e86de; color: #fff; font-size: 0.9rem; }
        .mode-btn { background: #d35400; color: #fff; font-size: 0.9rem; }
        
        /* Tooltip åœ–ç¤ºæ¨£å¼ */
        .info-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: #666;
            color: #fff;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            font-size: 1rem;
            margin-left: 8px;
            cursor: help;
        }

        .active-loop { background: #00ffcc !important; color: #000 !important; }
        .active-time { background: #feca57 !important; color: #000 !important; }
        .stop-btn { background: #ff4757; color: #fff; font-size: 0.8rem; padding: 5px; margin-top: 5px; height: auto; display: inline-block; }

        .water-color { color: #54a0ff; }
        .cube-color { color: #ff9ff3; }
        .blink { animation: blinker 0.4s linear infinite; color: #ff4757 !important; }
        @keyframes blinker { 50% { opacity: 0.3; } }
        
        input[type=range] { width: 90%; margin-top: 5px; }
        label { font-size: 0.8rem; color: #aaa; }
    </style>
</head>
<body>

<div class="setting-box">
    <label>èªéŸ³é€Ÿåº¦: <span id="rateValue">1.5</span>x</label><br>
    <input type="range" id="rateRange" min="0.5" max="2.0" step="0.1" value="1.5" oninput="updateRate(this.value)">
</div>

<div class="card card-loop">
    <div id="loop-status" class="title water-color">ä¸‹ä¸€éšæ®µï¼šé»‘æ°´</div>
    <div id="loop-timer" class="timer-display">40</div>
    
    <div style="display: flex; justify-content: center; align-items: center;">
        <button class="btn start-btn" id="loopBtn" onclick="startLoop()">
            é–‹å§‹ / æ©Ÿåˆ¶å°é½Šé‡ç½®
        </button>
        <span class="info-icon" data-tippy-content="é€²å…¥æœ¬é«”éšæ®µæ™‚ï¼Œ<br />çœ‹åˆ°é»‘æ°´æˆ–é›™é­”æ–¹å‡ºç¾é‚£ä¸€åˆ»é»æ“Š<br />(æœ¬é«”ç¬¬ä¸‰éšæ®µçš†å›ºå®šå–®é­”æ–¹)ï¼Œ<br />å¯è®“è¨ˆæ™‚èˆ‡æ©Ÿåˆ¶å®Œå…¨åŒæ­¥ã€‚">â“˜</span>
    </div>
    <!-- <div style="display: flex; gap: 8px; margin-bottom: 10px;"> -->
    <div style="display: flex; justify-content: center; align-items: center; margin-bottom: 20px;">
        <button class="btn mode-btn" style="height: 60px; margin-bottom: 0;" onclick="toggleLoopMode()">ğŸ”„ èª¿æ•´æç¤ºæ©Ÿåˆ¶ åˆ‡æ› é»‘æ°´/é­”æ–¹</button>
        <span class="info-icon" data-tippy-content="å¯èª¿æ•´ä¸‹ä¸€å€‹è¦æç¤ºçš„æ©Ÿåˆ¶ã€‚">â“˜</span>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; margin-bottom: 20px;">
        <button class="btn delay-btn" style="height: 60px; margin-bottom: 0;" onclick="addLoopTime(10)">æ‹›å–šæ€ªç‰© +10ç§’å»¶é²</button>
        <span class="info-icon" data-tippy-content="ç•¶æç¤ºé€šçŸ¥æ™‚æ²’å‡ºç¾æ­£ç¢ºæ©Ÿåˆ¶ï¼Œ<br />æ‡‰ç‚ºæœ¬é«”æ‹›æ›æ€ªç‰©ï¼Œ<br />é»æ“Šå¯å¢åŠ 10ç§’èª¿æ•´æ©Ÿåˆ¶æ™‚é–“ã€‚">â“˜</span>
    </div>
    <!-- </div> -->
    <button class="btn stop-btn" onclick="stopLoop()">åœæ­¢è¨ˆæ™‚</button>
</div>

<div class="card card-time">
    <div id="time-title" class="title" style="color:#feca57">æ™‚é–“é­”æ–¹ (2:30)</div>
    <div id="time-timer" class="timer-display" style="color:#feca57">02:30</div>
    <div style="display: flex; justify-content: center; align-items: center; margin-bottom: 20px;">
        <button class="btn start-btn" id="timeBtn" onclick="startTimeTimer()">
            é–‹å§‹ / å‡ºç”Ÿå°é½Š
        </button>
        <span class="info-icon" data-tippy-content="é–‹å ´æ‹›å–šç‚é­”æ™‚é»æ“Šï¼Œ<br />ç”¨æ–¼é æ¸¬æ™‚é–“é­”æ–¹ã€‚<br />(æœ¬é«”ç¬¬ä¸‰éšæ®µä¸é©ç”¨)">â“˜</span>
    </div>
    <button class="btn stop-btn" onclick="stopTimeTimer()">åœæ­¢è¨ˆæ™‚</button>
</div>

<script src="https://unpkg.com/@popperjs/core@2"></script>
<script src="https://unpkg.com/tippy.js@6"></script>

<script>
    // åˆå§‹åŒ– Tooltip
    tippy('[data-tippy-content]', {
        theme: 'material',
        // trigger: 'click', // æ‰‹æ©Ÿç‰ˆå»ºè­°é»æ“Šè§¸ç™¼
        placement: 'top',
        arrow: true,
        allowHTML: true,
    });

    // --- ä»¥ä¸‹ç‚ºåŸå§‹è¨ˆæ™‚é‚è¼¯ ---
    let speechRate = 1.5;
    function updateRate(val) { speechRate = val; document.getElementById('rateValue').innerText = val; }

    function speak(text) {
        window.speechSynthesis.cancel();
        const msg = new SpeechSynthesisUtterance(text);
        msg.lang = 'zh-TW';
        msg.rate = speechRate;
        window.speechSynthesis.speak(msg);
    }

    function unlock() {
        window.speechSynthesis.speak(new SpeechSynthesisUtterance(" "));
    }

    let loopSeconds = 40;
    let loopInterval = null;
    let loopMode = "water";
    let loopSpoken10 = false, loopSpoken3 = false;

    function toggleLoopMode() {
        loopMode = (loopMode === "water" ? "cube" : "water");
        loopSpoken10 = false; loopSpoken3 = false;
        updateLoopUI();
    }

    function addLoopTime(sec) {
        loopSeconds += sec;
        loopSpoken10 = false; loopSpoken3 = false;
        updateLoopUI();
    }

    function startLoop() {
        unlock(); clearInterval(loopInterval);
        loopSeconds = 40; 
        loopSpoken10 = false; loopSpoken3 = false;
        document.getElementById('loopBtn').classList.add('active-loop');
        loopInterval = setInterval(() => {
            loopSeconds--;
            if (loopSeconds === 10 && !loopSpoken10) { speak(loopMode === "water" ? "åç§’å¾Œé»‘æ°´" : "åç§’å¾Œé›™é­”æ–¹"); loopSpoken10 = true; }
            if (loopSeconds === 3 && !loopSpoken3) { speak(loopMode === "water" ? "é»‘æ°´ï¼Œé»‘æ°´" : "é›™é­”æ–¹ï¼Œé›™é­”æ–¹"); loopSpoken3 = true; }
            if (loopSeconds <= 0) { 
                loopMode = (loopMode === "water" ? "cube" : "water"); 
                loopSeconds = 40; loopSpoken10 = false; loopSpoken3 = false; 
            }
            updateLoopUI();
        }, 1000);
    }

    function stopLoop() {
        clearInterval(loopInterval);
        document.getElementById('loopBtn').classList.remove('active-loop');
        loopSeconds = 40; updateLoopUI();
    }

    function updateLoopUI() {
        const el = document.getElementById('loop-timer');
        const st = document.getElementById('loop-status');
        el.innerText = loopSeconds;
        st.innerText = loopMode === "water" ? "ä¸‹ä¸€éšæ®µï¼šé»‘æ°´" : "ä¸‹ä¸€éšæ®µï¼šé›™é­”æ–¹";
        st.className = "title " + (loopMode === "water" ? "water-color" : "cube-color");
        loopSeconds <= 6 ? el.classList.add('blink') : el.classList.remove('blink');
    }

    let timeMax = 150;
    let timeSeconds = 150;
    let timeInterval = null;
    let timeSpoken10 = false, timeSpoken3 = false;

    function startTimeTimer() {
        unlock(); clearInterval(timeInterval);
        timeSeconds = timeMax;
        timeSpoken10 = false; timeSpoken3 = false;
        document.getElementById('timeBtn').classList.add('active-time');
        timeInterval = setInterval(() => {
            timeSeconds--;
            if (timeSeconds === 10 && !timeSpoken10) { speak("åç§’å¾Œæ™‚é–“é­”æ–¹"); timeSpoken10 = true; }
            if (timeSeconds === 3 && !timeSpoken3) { speak("æ™‚é–“é­”æ–¹ï¼Œæ™‚é–“é­”æ–¹"); timeSpoken3 = true; }
            if (timeSeconds <= 0) { timeSeconds = timeMax; timeSpoken10 = false; timeSpoken3 = false; }
            updateTimeUI();
        }, 1000);
    }

    function stopTimeTimer() {
        clearInterval(timeInterval);
        document.getElementById('timeBtn').classList.remove('active-time');
        timeSeconds = timeMax; updateTimeUI();
    }

    function updateTimeUI() {
        const el = document.getElementById('time-timer');
        const m = Math.floor(timeSeconds / 60), s = timeSeconds % 60;
        el.innerText = `${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
        timeSeconds <= 10 ? el.classList.add('blink') : el.classList.remove('blink');
    }
</script>
</body>
</html>